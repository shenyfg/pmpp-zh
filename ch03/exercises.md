# 第3章

### 练习 1

在本章中,我们实现了一个矩阵乘法内核,让每个线程产生一个输出矩阵元素。在这个问题中,你将实现不同的矩阵-矩阵乘法内核并比较它们。

**a.** 编写一个内核,让每个线程产生一个输出矩阵行。填写该设计的执行配置参数。

**b.** 编写一个内核,让每个线程产生一个输出矩阵列。填写该设计的执行配置参数。

**c.** 分析这两种内核设计的优缺点。

### 练习 2

矩阵-向量乘法接收一个输入矩阵 B 和一个向量 C,并产生一个输出向量 A。输出向量 A 的每个元素是输入矩阵 B 的一行与 C 的点积,即 `A[i] = sum_over_j(B[i][j] * C[j])`。为简单起见,我们只处理元素为单精度浮点数的方阵。编写一个矩阵-向量乘法内核和主机桩函数,该函数可以用四个参数调用:指向输出向量的指针、指向输入矩阵的指针、指向输入向量的指针以及每个维度的元素数量。使用一个线程来计算一个输出向量元素。

### 练习 3

考虑以下 CUDA 内核及其对应的调用它的主机函数:

```c
01 __global__ void foo_kernel(float* a, float* b, unsigned int M, unsigned int N) {
02     unsigned int row = blockIdx.y * blockDim.y + threadIdx.y;
03     unsigned int col = blockIdx.x * blockDim.x + threadIdx.x;
04     if (row < M && col < N) {
05         b[row*N + col] = a[row*N + col]/2.1f + 4.8f;
06     }
07 }
08 void foo(float* a_d, float* b_d) {
09     unsigned int M = 150;
10     unsigned int N = 300;
11     dim3 bd(16, 32);
12     dim3 gd((N - 1) / 16 + 1, ((M - 1) / 32 + 1));
13     foo_kernel <<< gd, bd >>> (a_d, b_d, M, N);
14 }
```

**a. 每个块中有多少个线程?**

**b. 网格中有多少个线程?**

**c. 网格中有多少个块?**

**d. 有多少个线程执行第 05 行的代码?**

### 练习 4

考虑一个宽度为 400、高度为 500 的 2D 矩阵。该矩阵存储为一维数组。指定第 20 行第 10 列的矩阵元素的数组索引:

**a.** 如果矩阵以行主序(row-major order)存储。

**b.** 如果矩阵以列主序(column-major order)存储。

### 练习 5

考虑一个宽度为 400、高度为 500、深度为 300 的 3D 张量。该张量以行主序存储为一维数组。指定位于 x = 10, y = 20, z = 5 处的张量元素的数组索引。
